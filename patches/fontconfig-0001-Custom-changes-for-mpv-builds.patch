--- fontconfig-2.15.0.orig/src/fcdir.c	2025-11-04 11:00:21.772317421 -0500
+++ fontconfig-2.15.0/src/fcdir.c	2025-11-04 11:06:14.027751742 -0500
@@ -72,18 +72,9 @@
     int		old_nfont = set->nfont;
     const FcChar8 *sysroot = FcConfigGetSysRoot (config);
 
-    if (FcDebug () & FC_DBG_SCAN)
-    {
-	printf ("\tScanning file %s...", file);
-	fflush (stdout);
-    }
-
     if (!FcFreeTypeQueryAll (file, -1, NULL, NULL, set))
 	return FcFalse;
 
-    if (FcDebug () & FC_DBG_SCAN)
-	printf ("done\n");
-
     for (i = old_nfont; i < set->nfont; i++)
     {
 	FcPattern *font = set->fonts[i];
@@ -233,7 +224,7 @@
     base = file_prefix + strlen ((char *) file_prefix);
 
     if (FcDebug () & FC_DBG_SCAN)
-	printf ("\tScanning dir %s\n", s_dir);
+	fprintf (stderr, "[fontconfig] Scanning dir %s\n", dir);
 	
     d = opendir ((char *) s_dir);
     if (!d)
@@ -270,8 +261,29 @@
     /*
      * Scan file files to build font patterns
      */
+    char buf1[512], buf2[512], pad[512], *str = &buf1[0], *prev = &buf2[0], *tmp;
+    int j, diff;
+    prev[0] = pad[0] = 0;
+
     for (i = 0; i < files->num; i++)
-	FcFileScanConfig (set, dirs, files->strs[i], config);
+    {
+        snprintf (str, 512, "\r[%d/%d] %s", i+1, files->num, files->strs[i]);
+
+        for (diff = strlen (prev) - strlen (str), j = 0; diff > 0; diff--, j++)
+            pad[j] = ' ';
+
+        pad[j] = 0;
+
+        if (FcDebug () & FC_DBG_SCAN)
+            fprintf (stderr, "%s%s", str, pad);
+
+        tmp = str; str = prev; prev = tmp;
+
+        FcFileScanConfig (set, dirs, files->strs[i], config);
+    }
+
+    if (FcDebug () & FC_DBG_SCAN)
+	fprintf (stderr, "\n[fontconfig] Finished scanning dir %s\n", dir);
 
 bail2:
     FcStrSetDestroy (files);
--- fontconfig-2.15.0.orig/src/fcinit.c	2025-11-04 11:00:21.772379008 -0500
+++ fontconfig-2.15.0/src/fcinit.c	2025-11-04 11:11:35.046740966 -0500
@@ -35,6 +35,12 @@
 #pragma message("To suppress these warnings, define FC_NO_MT.")
 #endif
 
+#ifdef _WIN32
+#define _WIN32_IE 0x0500
+#include <shlobj.h>
+#include <malloc.h>
+#endif
+
 static FcConfig *
 FcInitFallbackConfig (const FcChar8 *sysroot)
 {
@@ -53,12 +59,41 @@
     config = FcConfigCreate ();
     if (!config)
 	goto bail0;
+
+#ifdef _WIN32
+    char *buf = malloc (MAX_PATH+1);
+    if (!buf) goto bail1;
+    if (SHGetFolderPathA (NULL, CSIDL_FONTS|CSIDL_FLAG_CREATE, NULL,
+	SHGFP_TYPE_CURRENT, buf) == S_OK) {
+	if (!FcConfigAddConfigDir (config, (FcChar8 *) buf))
+	    goto bail2;
+    }
+
+    char *buf2 = malloc (MAX_PATH+1);
+    if (!buf) goto bail2;
+    if (SHGetFolderPathA (NULL, CSIDL_LOCAL_APPDATA|CSIDL_FLAG_CREATE, NULL,
+	SHGFP_TYPE_CURRENT, buf2) == S_OK) {
+	if (buf2[strlen(buf2)-1] != '\\')
+	    strcat (buf2, "\\");
+	strcat (buf2, "fontconfig");
+	if (!FcConfigAddCacheDir (config, (FcChar8 *) buf2))
+	    goto bail3;
+    }
+#else
     FcConfigSetSysRoot (config, sysroot);
     if (!FcConfigParseAndLoadFromMemory (config, fallback, FcFalse))
 	goto bail1;
+#endif
 
     return config;
 
+#ifdef _WIN32
+bail3:
+    free(buf2);
+bail2:
+    free(buf);
+#endif
+
 bail1:
     FcConfigDestroy (config);
 bail0:
